[
  {
    "objectID": "Homework4-Jie Chen-st558.html",
    "href": "Homework4-Jie Chen-st558.html",
    "title": "Homework 4 - ST558",
    "section": "",
    "text": "The lapply() function in R is used to apply a function to each element of a list (or a vector, which is treated as a list of elements) and return the results in a list. It is a powerful function for iterating over lists and performing operations on each element.\nThe equivalent purrr function for lapply() is map().\n\n\n\nlapply(X=my_list,FUN=cor,method=“kendall”)\n\n\n\n(1) The purrr package provides a consistent and readable approach to functional programming in R, with well-named functions and tidy evaluation principles.\n(2) purrr offers type-specific functions (map_dbl(), map_chr(), map_int(), map_lgl() ) that ensure the output is of a specific type.\n\n\n\nA side-effect function performs operations that affect the state outside its own scope, in addition to returning a value. These operations can include modifying global variables, changing the state of objects, writing to a file, printing to the console, or performing I/O operations.\n\n\n\nR uses lexical scoping, that when it looks up the value of a name, it searches through a series of environments in a specific order. If a name is found in an environment, R stops searching and uses that value."
  },
  {
    "objectID": "Homework4-Jie Chen-st558.html#task-1-conceptual-questions",
    "href": "Homework4-Jie Chen-st558.html#task-1-conceptual-questions",
    "title": "Homework 4 - ST558",
    "section": "",
    "text": "The lapply() function in R is used to apply a function to each element of a list (or a vector, which is treated as a list of elements) and return the results in a list. It is a powerful function for iterating over lists and performing operations on each element.\nThe equivalent purrr function for lapply() is map().\n\n\n\nlapply(X=my_list,FUN=cor,method=“kendall”)\n\n\n\n(1) The purrr package provides a consistent and readable approach to functional programming in R, with well-named functions and tidy evaluation principles.\n(2) purrr offers type-specific functions (map_dbl(), map_chr(), map_int(), map_lgl() ) that ensure the output is of a specific type.\n\n\n\nA side-effect function performs operations that affect the state outside its own scope, in addition to returning a value. These operations can include modifying global variables, changing the state of objects, writing to a file, printing to the console, or performing I/O operations.\n\n\n\nR uses lexical scoping, that when it looks up the value of a name, it searches through a series of environments in a specific order. If a name is found in an environment, R stops searching and uses that value."
  },
  {
    "objectID": "Homework4-Jie Chen-st558.html#task-2---writing-r-functions",
    "href": "Homework4-Jie Chen-st558.html#task-2---writing-r-functions",
    "title": "Homework 4 - ST558",
    "section": "Task 2 - Writing R Functions",
    "text": "Task 2 - Writing R Functions\n\nWrite a basic function (getRMSE()) that takes in a vector of responses and a vector of predictions and outputs the RMSE.\n\n\ngetRMSE &lt;- function(resp, pred){\n  residual &lt;- resp - pred\n  residual_sq &lt;- residual^2\n  m_residual_sq &lt;-mean(residual_sq)\n  RMSE &lt;-sqrt(m_residual_sq)\n  return(RMSE)\n}\n\nIf a value is missing for the vector of responses (i.e. an NA is present), allow for additional arguments to the mean() function that removes the NA values in the computation.\n\n# add Ellipsis (...) Argument\ngetRMSE &lt;- function(resp, pred,...){\n  # check two vectors are numeric, if not print a message and exit\n  if (!is.numeric(resp) || !is.numeric(pred)) {\n    stop(\"Must be numeric vectors.\")\n  }\n  residual &lt;- resp - pred\n  residual_sq &lt;- residual^2\n  # passing additional argument to mean\n  m_residual_sq &lt;-mean(residual_sq,...)\n  RMSE &lt;-sqrt(m_residual_sq)\n  return(RMSE)\n}\n\n\nspecify na.rm = TRUE to remove NA values from the computation getRMSE(resp,pred,na.rm=TRUE) *\n\n\nCreate some responses and predictions.\n\n\nset.seed(10)\nn &lt;-100\nx &lt;-runif(n)\nresp &lt;-3+10*x +rnorm(n)\npred &lt;-predict(lm(resp ~x),data.frame(x))\n\n# test RMSE function \ngetRMSE(resp,pred,na.rm=TRUE)\n\n[1] 0.9581677\n\n\n\n# replace two response values with missing values (NA_real_)\nind &lt;-c(2,5)\nresp[ind] &lt;-NA_real_\n\n# test RMSE function \n# not specifying dealing with missing values\ngetRMSE(resp,pred)\n\n[1] NA\n\n# specifying dealing with missing values\ngetRMSE(resp,pred,na.rm=TRUE)\n\n[1] 0.9653433\n\n\n\nAnother common metric for evaluating predictions is mean absolute deviation\n\n\n# write a function getMAE()\ngetMAE &lt;- function(resp,pred,...) {\n  # check two vectors are numeric, if not print a message and exit\n  if (!is.numeric(resp) || !is.numeric(pred)){\n    stop(\"Must be numeric vectors.\")\n  }\n  residual &lt;- resp - pred\n  residual_abs &lt;- abs(residual)\n  # passing additional argument to mean\n  MAE &lt;-mean(residual_abs,...)\n  return(MAE)\n}\n\n\n# create some response and predictions\nset.seed(10)\nn &lt;-100\nx &lt;-runif(n)\nresp &lt;- 3+ 10*x +rnorm(n)\npred &lt;- predict(lm(resp ~x),data.frame(x))\n\n# test MAE function\ngetMAE(resp,pred)\n\n[1] 0.8155776\n\ngetMAE(resp,pred,na.rm=TRUE)\n\n[1] 0.8155776\n\n\n\n# replace two of the response values with missing values\nind &lt;-c(2,7)\nresp[ind]&lt;-NA_real_\n\n# test MAE function \n# specifying dealing with missing values\ngetMAE(resp,pred,na.rm=TRUE)\n\n[1] 0.8200423\n\n# without specifying dealing with missing values\ngetMAE(resp,pred)\n\n[1] NA\n\n\n\ncreate a wrapper function to get either or both metrics returned\n\n\ngetMETRICS &lt;- function(resp, pred, metrics=c(\"RMSE\", \"MAE\"),...) {\n  results &lt;- list()\n  if (\"RMSE\" %in% metrics) {\n    rmse_value &lt;- getRMSE(resp, pred, ...)\n    results$RMSE &lt;- rmse_value\n  }\n  \n  if (\"MAE\" %in% metrics) {\n    mae_value &lt;- getMAE(resp, pred, ...)\n    results$MAE &lt;- mae_value\n  }\n  \n  return(results)\n}\n\n\ncreate response values and predictions and test function\n\n\n# create response values and predictions\nset.seed(10)\nn &lt;-100\nx &lt;-runif(n)\nresp &lt;-3+10*x +rnorm(n)\npred &lt;-predict(lm(resp ~x),data.frame(x))\n\n# test new function \n# Compute RMSE only\ngetMETRICS(resp, pred,metrics=\"RMSE\", na.rm = TRUE)\n\n$RMSE\n[1] 0.9581677\n\n# Compute MAE only\ngetMETRICS(resp, pred,metrics=\"MAE\", na.rm = TRUE)\n\n$MAE\n[1] 0.8155776\n\n# Compute both RMSE and MAE by default\ngetMETRICS(resp, pred, na.rm = TRUE)\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 0.8155776\n\n# compute both RMSE and MAE by explicitly\ngetMETRICS(resp,pred,merics=c(\"RMSE\",\"MAE\"),na.rm=TRUE)\n\n$RMSE\n[1] 0.9581677\n\n$MAE\n[1] 0.8155776\n\n# replace two response values with missing values (NA_real_)\nind &lt;-c(2,5)\nresp[ind] &lt;-NA_real_\n\n# test new function \n# Compute RMSE only\ngetMETRICS(resp, pred,metrics=\"RMSE\", na.rm = TRUE)\n\n$RMSE\n[1] 0.9653433\n\n# Compute MAE only\ngetMETRICS(resp, pred,metrics=\"MAE\", na.rm = TRUE)\n\n$MAE\n[1] 0.822657\n\n# Compute both RMSE and MAE by default\ngetMETRICS(resp, pred, na.rm = TRUE)\n\n$RMSE\n[1] 0.9653433\n\n$MAE\n[1] 0.822657\n\n# compute both RMSE and MAE by explicitly\ngetMETRICS(resp,pred,merics=c(\"RMSE\",\"MAE\"),na.rm=TRUE)\n\n$RMSE\n[1] 0.9653433\n\n$MAE\n[1] 0.822657\n\n\n\n# test function by passing incorrect data\ndf &lt;-data.frame(resp,pred)\ngetMETRICS(df,pred,na.rm=TRUE)"
  },
  {
    "objectID": "Homework4-Jie Chen-st558.html#task-3---querying-an-api-and-a-tidy-style-function",
    "href": "Homework4-Jie Chen-st558.html#task-3---querying-an-api-and-a-tidy-style-function",
    "title": "Homework 4 - ST558",
    "section": "Task 3 - Querying an API and a Tidy-Style Function",
    "text": "Task 3 - Querying an API and a Tidy-Style Function\n\nUse GET() from the httr package to return info about a topic interested lately\n\n\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(tidyverse)\n\n# Connect to the news API: newsapi.org\n# my API key\nsource(\"api_key.R\")\nprint(api_key)\n\n[1] \"03b9060366374f6d9459d2396315a0e8\"\n\n# define topic interested\ntopic &lt;-\"heat wave\"\n\n# build the URL for the API request\nurl &lt;- paste0(\"https://newsapi.org/v2/everything?q=\", URLencode(topic), \"&apiKey=\", api_key)\n# url &lt;-\"https://newsapi.org/v2/everything?q=heat%20wave&apiKey=03b9060366374f6d9459d2396315a0e8\"\n\n# Make the GET request\nresponse &lt;- GET(url)\n# check the structure of the response\nstr(response,max.level=1)\n\nList of 10\n $ url        : chr \"https://newsapi.org/v2/everything?q=heat%20wave&apiKey=03b9060366374f6d9459d2396315a0e8\"\n $ status_code: int 200\n $ headers    :List of 14\n  ..- attr(*, \"class\")= chr [1:2] \"insensitive\" \"list\"\n $ all_headers:List of 1\n $ cookies    :'data.frame':    0 obs. of  7 variables:\n $ content    : raw [1:82800] 7b 22 73 74 ...\n $ date       : POSIXct[1:1], format: \"2024-06-23 22:16:58\"\n $ times      : Named num [1:6] 0 0.0212 0.0618 0.1047 0.2924 ...\n  ..- attr(*, \"names\")= chr [1:6] \"redirect\" \"namelookup\" \"connect\" \"pretransfer\" ...\n $ request    :List of 7\n  ..- attr(*, \"class\")= chr \"request\"\n $ handle     :Class 'curl_handle' &lt;externalptr&gt; \n - attr(*, \"class\")= chr \"response\"\n\n\n\nparse the response\n\n\nparsed &lt;-fromJSON(rawToChar(response$content))\n\narticle_info &lt;-as_tibble(parsed$articles)\n\n# Ensure the first column is a list column containing relevant details\narticle_info &lt;- article_info |&gt;\n  rowwise() |&gt;\n  mutate(source = list(list(source$id,source$name)))\n  \narticle_info\n\n# A tibble: 100 × 8\n# Rowwise: \n   source     author      title description url   urlToImage publishedAt content\n   &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;list [2]&gt; Olivia Ham… Heat… NPR's Mich… http… https://n… 2024-06-19… \"The E…\n 2 &lt;list [2]&gt; Michel Mar… Extr… NPR's Mich… http… https://m… 2024-06-21… \"NPR's…\n 3 &lt;list [2]&gt; Juliana Kim Heat… As the hea… http… https://n… 2024-06-22… \"A maj…\n 4 &lt;list [2]&gt; Joe Hernan… Mill… A swelteri… http… https://n… 2024-06-16… \"A swe…\n 5 &lt;list [2]&gt; Solcyré Bu… Here… Record-hig… http… https://a… 2024-06-17… \"The e…\n 6 &lt;list [2]&gt; Rachel Tre… Heat… As New Eng… http… https://n… 2024-06-20… \"The U…\n 7 &lt;list [2]&gt; Rachel Tre… Summ… Astronomic… http… https://n… 2024-06-20… \"Summe…\n 8 &lt;list [2]&gt; Max Golembo Swel… Heat alert… http… https://i… 2024-06-20… \"Heat …\n 9 &lt;list [2]&gt; Solcyré Bu… How … The first … http… https://a… 2024-06-05… \"The f…\n10 &lt;list [2]&gt; Emily Mae … Delh… A substati… http… https://s… 2024-05-29… \"A tem…\n# ℹ 90 more rows\n\n\n\nwrite a function hat allows user to query this API\n\n\n# Define the function\nquery_news_api &lt;- function(subject, start_date, api_key) {\n  # Build the URL for the API request\n  url &lt;- paste0(\n    \"https://newsapi.org/v2/everything?\",\n    \"q=\", URLencode(subject),\n    \"&from=\", start_date,\n    \"&sortBy=publishedAt\",\n    \"&apiKey=\", api_key\n  )\n  # Make the GET request\n  response &lt;- GET(url)\n  str(response,max.level=1)\n\n  # parse the response\n  parsed &lt;-fromJSON(rawToChar(response$content))\n\n  article_info &lt;-as_tibble(parsed$articles)\n\n  # Ensure the first column is a list column containing relevant details\n  article_info &lt;- article_info |&gt;\n    rowwise() |&gt;\n    mutate(source = list(list(source$id,source$name)))\n    \n  return(article_info)\n}\n\nsearch1 &lt;-query_news_api(\"heat wave\", \"2024-06-15\",api_key)\n\nList of 10\n $ url        : chr \"https://newsapi.org/v2/everything?q=heat%20wave&from=2024-06-15&sortBy=publishedAt&apiKey=03b9060366374f6d9459d2396315a0e8\"\n $ status_code: int 200\n $ headers    :List of 14\n  ..- attr(*, \"class\")= chr [1:2] \"insensitive\" \"list\"\n $ all_headers:List of 1\n $ cookies    :'data.frame':    0 obs. of  7 variables:\n $ content    : raw [1:80721] 7b 22 73 74 ...\n $ date       : POSIXct[1:1], format: \"2024-06-23 22:16:59\"\n $ times      : Named num [1:6] 0 0.000085 0 0.000245 0.181299 ...\n  ..- attr(*, \"names\")= chr [1:6] \"redirect\" \"namelookup\" \"connect\" \"pretransfer\" ...\n $ request    :List of 7\n  ..- attr(*, \"class\")= chr \"request\"\n $ handle     :Class 'curl_handle' &lt;externalptr&gt; \n - attr(*, \"class\")= chr \"response\"\n\nsearch1\n\n# A tibble: 100 × 8\n# Rowwise: \n   source     author      title description url   urlToImage publishedAt content\n   &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;list [2]&gt; \"OLIVIA M.… High… \"Lancaster… http… https://b… 2024-06-22… \"Lanca…\n 2 &lt;list [2]&gt; \"OLIVIA M.… Satu… \"Lancaster… http… https://b… 2024-06-22… \"Lanca…\n 3 &lt;list [2]&gt; \"Juliana K… Heat… \"As the he… http… https://n… 2024-06-22… \"A maj…\n 4 &lt;list [2]&gt; \"Ian Livin… Wash… \"The fifth… http… https://w… 2024-06-22… \"For t…\n 5 &lt;list [2]&gt; \"Michelle … NYPD… \"Two teens… http… https://a… 2024-06-22… \"Polic…\n 6 &lt;list [2]&gt; \"usatoday.… What… \"What's th… http… https://b… 2024-06-22… \"What'…\n 7 &lt;list [2]&gt;  &lt;NA&gt;       Powe…  &lt;NA&gt;       http… &lt;NA&gt;       2024-06-22… \"If yo…\n 8 &lt;list [2]&gt; \"Angela Ba… NYC’… \"The curre… http… https://n… 2024-06-22… \"The B…\n 9 &lt;list [2]&gt; \"Brian Bus… Iowa… \"Heavy rai… http… https://i… 2024-06-22… \"Resid…\n10 &lt;list [2]&gt; \"Ed White,… Much… \"The gover… http… https://d… 2024-06-22… \"The g…\n# ℹ 90 more rows\n\nsearch2 &lt;-query_news_api(\"president\", \"2024-06-20\", api_key)\n\nList of 10\n $ url        : chr \"https://newsapi.org/v2/everything?q=president&from=2024-06-20&sortBy=publishedAt&apiKey=03b9060366374f6d9459d2396315a0e8\"\n $ status_code: int 200\n $ headers    :List of 14\n  ..- attr(*, \"class\")= chr [1:2] \"insensitive\" \"list\"\n $ all_headers:List of 1\n $ cookies    :'data.frame':    0 obs. of  7 variables:\n $ content    : raw [1:81763] 7b 22 73 74 ...\n $ date       : POSIXct[1:1], format: \"2024-06-23 22:16:59\"\n $ times      : Named num [1:6] 0 0.000057 0 0.000193 0.150635 ...\n  ..- attr(*, \"names\")= chr [1:6] \"redirect\" \"namelookup\" \"connect\" \"pretransfer\" ...\n $ request    :List of 7\n  ..- attr(*, \"class\")= chr \"request\"\n $ handle     :Class 'curl_handle' &lt;externalptr&gt; \n - attr(*, \"class\")= chr \"response\"\n\nsearch2\n\n# A tibble: 100 × 8\n# Rowwise: \n   source     author      title description url   urlToImage publishedAt content\n   &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;list [2]&gt; \"msnbc.com\" No c… \"Gen. Wesl… http… https://b… 2024-06-22… \"Gen. …\n 2 &lt;list [2]&gt; \"feedfeede… Cali… \"Californi… http… &lt;NA&gt;       2024-06-22… \"Sign …\n 3 &lt;list [2]&gt; \"Michelle … Spea… \"In Washin… http… https://d… 2024-06-22… \"WASHI…\n 4 &lt;list [2]&gt; \"David McA… 'For… \"The autho… http… https://w… 2024-06-22… \"The a…\n 5 &lt;list [2]&gt; \"Agencies\"  Thre… \"Europe Ne… http… https://s… 2024-06-22… \"10 be…\n 6 &lt;list [2]&gt; \"Lance Rey… Bost… \"As visito… http… https://w… 2024-06-22… \"Brian…\n 7 &lt;list [2]&gt; \"ft.com\"    Trum… \"Ex-presid… http… https://b… 2024-06-22… \"Ex-pr…\n 8 &lt;list [2]&gt; \"Ryan Mori… NASC… \"Daniel Su… http… https://s… 2024-06-22… \"NASCA…\n 9 &lt;list [2]&gt;  &lt;NA&gt;       [Rem… \"[Removed]\" http… &lt;NA&gt;       1970-01-01… \"[Remo…\n10 &lt;list [2]&gt; \"Avik Roy,… To R… \"The U.S. … http… https://i… 2024-06-22… \"Under…\n# ℹ 90 more rows"
  }
]